[tox]
envlist = dbt110,dbt150
isolated_build = true
skip_missing_interpreters = true
require_poetry = true

setenv =
    COVERAGE_FILE = .coverage.{envname}

passenv = PROFILE_DBT_COVES_REDSHIFT,HOST_REDSHIFT,USER_REDSHIFT,PASSWORD_REDSHIFT,DATABASE_REDSHIFT,SCHEMA_REDSHIFT,PROFILE_DBT_COVES_SNOWFLAKE,USER_SNOWFLAKE,PASSWORD_SNOWFLAKE,ACCOUNT_SNOWFLAKE,WAREHOUSE_SNOWFLAKE,ROLE_SNOWFLAKE,DATABASE_SNOWFLAKE,SCHEMA_SNOWFLAKE,PROFILE_DBT_COVES_BIGQUERY,SERVICE_ACCOUNT_GCP,PROJECT_BIGQUERY,DATASET_BIGQUERY,[testenv:dbt110]
deps=
    dbt-core==1.1.0
    dbt-postgres==1.1.0
    dbt-bigquery==1.1.0
    dbt-snowflake==1.1.0
    redshift-connector
    pytest
    coverage
allowlist_externals =
    poetry
    echo
    pytest
commands =
    poetry run pytest --cov-report=xml:coverage-reports/dbt110-coverage.xml --cov-report term-missing  --cov=dbt_coves tests/
    coverage report -m

[testenv:150]
deps=
    dbt-core==1.5.0
    dbt-postgres==1.5.0
    dbt-bigquery==1.5.0
    dbt-snowflake==1.5.0
    redshift-connector
    pytest
    coverage
allowlist_externals =
    poetry
    echo
    pytest
commands =
    poetry run pytest --cov-report=xml:coverage-reports/coverage.xml --cov-report term-missing  --cov=dbt_coves tests/
    coverage report -m

[gh-actions]
python =
    3.8: py38
    3.7: py37

[gh-actions:env]
PLATFORM =
    ubuntu-latest: linux
    windows-latest: windows
